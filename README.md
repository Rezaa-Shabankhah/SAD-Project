## معرفی کلی پروژه

این پروژه یک سیستم مدیریت انجمن دانشجویی است که بر مبنای فریم‌ورک Django و پایگاه داده MySQL طراحی شده است. رابط متنی CLI از طریق APIهای REST با سرور ارتباط برقرار می‌کند.

### مراحل اجرا :

ابتدا یک‌بار دستورات زیر را از دایرکتری اصلی فایل‌ها اجرا کنید :

```
pip install Django djangorestframework pymysql requests colorama

mysql -u root -p < university_association.sql

python manage.py migrate

python manage.py createsuperuser --username admin --email admin@example.com
```

> در پسورد اول : رمز سرور root در MySQL خود را وارد کنید (در کد از رمز 12345 استفاده شده)

> در پسورد دوم و سوم : رمز دلخواه خود را برای حساب Django admin که با دستور createsuperuser ساخته می‌شود وارد کنید (یوزرنیم همان admin ست شده)

سپس دستور زیر را اجرا کنید تا سرور برای پنل ادمین و رابط CLI آماده شود :

```
python manage.py runserver
```

1. برای پنل ادمین --> به آدرس زیر رفته و مشخصات حسابی که با ساخته‌اید را وارد کنید :

```
http://127.0.0.1:8000/admin/
```

2. برای دسترسی به رابط کاربری CLI --> دستور زیر را از دایکتری اصلی فایل‌ها اجرا کنید :

```
python cli.py
```

Role: Admin

StudentID: 1

Email: admin

Password : 0

---

Role: Member

StudentID: 2

Email: member

Password : 0

---

Role: Student

StudentID: 3, 4 or 5

Email: \[new]

Password : \[new]

## ساختار کلی پروژه

پروژه در دو بخش اصلی تقسیم شده است:

* **بخش Django (backend)**: شامل models و serializers و views و routing برای API های REST
* **بخش CLI**: رابط کاربری متنی که از طریق درخواست‌های HTTP به APIها متصل می‌شود



### معماری پایگاه داده

* جدول **students**: اطلاعات پایه دانشجویان شامل شماره دانشجویی، نام و نقش
* جدول **users**: اطلاعات حساب کاربری مرتبط با هر دانشجو
* جدول **article** و **article\_authors**: مقالات و رابطه نویسندگان
* جدول **announcement**: اعلانات عمومی انجمن
* جدول **event** و **event\_registration**: رویدادها با قابلیت ثبت‌نام محدود
* جدول **comments**: سیستم نظردهی عمومی

جدول Students هسته است و Users به آن متصل است. مقالات از طریق `article_authors` چندنویسنده را پشتیبانی می‌کنند. رویدادها از طریق `event_registration` به کاربران متصل می‌شوند.

### تنظیمات پایگاه داده:

پروژه از PyMySQL برای اتصال به MySQL استفاده می‌کند. در فایل `university_association_project/__init__.py` فراخوانی `pymysql.install_as_MySQLdb()` شده است. تنظیمات اتصال در `settings.py` به صورت localhost روی پورت 3306 قرار دارد.

### طراحی Models:

تمامی مدل‌ها با `managed = False` تعریف شده‌اند تا schema توسط SQL خام (فایل `university_association.sql`) مدیریت شود. هر مدل دارای Meta با نام جدول مربوطه است.

* مدل **Student**: فیلد `role` با مقادیر `STUDENT`, `MEMBER`, `ADMIN`
* مدل **Article**: فیلد `status` برای مدیریت فرآیند تایید
* مدل **Comment**: با `target_type` و `target_id` برای اضافه شدن کامنت به انواع محتوا
* مدل **Event**: فیلدهای `capacity` و `registered_count` برای مدیریت ظرفیت

## APIها و رفتار کلی

* مسیریابی API تحت `/api/` قرار دارد.
* endpoint ورود `/api/login/` پیامدهای زیر را دارد: دریافت `student_number` برای شناسایی، در صورت نیاز بررسی `email` و `password` برای احراز هویت، در صورت عدم وجود حساب کاربری پاسخ مناسب برمی‌گرداند.
* endpoint ایجاد کاربر `/api/users/` برای ساخت حساب جدید مرتبط با یک دانشجو.
* CRUD اعلان‌ها `/api/announcements/` و `/api/announcements/<id>/` با کنترل نقش در عملیات ویرایش و حذف.
* مقاله‌ها `/api/articles/` و `/api/articles/<id>/` با فیلتر `status` و مسیرهای مدیریتی برای بررسی مقالات معلق تحت `/api/admin/...`.
* رویدادها `/api/events/` و `/api/events/<id>/join/` برای ثبت‌نام.
* نظرات `/api/comments/` و `/api/comments/<id>/` برای درج و حذف نظرات.
* برخی عملیات مدیریتی مانند مشاهده کاربران و مقالات معلق از مسیرهای `/api/admin/...` قابل دسترسی است.
* CLI با ارسال `user id` و `role` در payload عملیات را انجام می‌دهد. API بی‌حالت است و توکن احراز هویت استفاده نمی‌کند.

## رابط کاربری Command Line

رابط CLI ابتدا با `/api/login/` شماره دانشجویی را می‌فرستد. اگر حسابی موجود نباشد کاربر از طریق `/api/users/` ساخته می‌شود. بعد از ورود، منوی اصلی شامل موارد زیر خواهد بود:

* مشاهده و مدیریت اعلانات
* مطالعه و درخواست مقالات
* مشاهده و ثبت‌نام در رویدادها
* پنل مدیریت (تنها برای ادمین)

#### بخش اعلانات:

کاربران با نقش MEMBER یا ADMIN می‌توانند اعلان جدید ایجاد کنند. همه کاربران قابلیت مشاهده اعلانات را دارند. ویرایش و حذف اعلان‌ها با ارسال `role` مناسب انجام می‌شود.

#### بخش مقالات:

کاربران عادی درخواست انتشار مقاله می‌دهند که به صورت `PENDING` ثبت می‌شود. ادمین‌ها قادر به ایجاد مستقیم مقاله با `APPROVED` یا بررسی و تغییر وضعیت مقالات معلق هستند.

#### بخش رویدادها:

ثبت‌نام در رویدادها با درخواست به endpoint مربوطه انجام می‌شود. محدودیت ظرفیت بررسی می شود و `registered_count` در سرور به‌روز می‌شود. ادمین‌ها قادر به ایجاد رویداد هستند.

### پنل مدیریت

تمام دسترسی های ادمین (که در پنل ادمین جنگو موجود بود) در رابط CLI نیز قابل دسترسی است.

## نکات فنی پیاده‌سازی

* سرور از Django ORM و serializers در DRF برای اعتبارسنجی ورودی‌ها و عملیات دیتابیس استفاده می‌کند.
* رابط CLI از `requests` برای فراخوانی HTTP استفاده می‌کند.
* مدل‌ها با `managed = False` تعریف شده‌اند و ساختار اصلی جداول از طریق فایل SQL وارد می‌شود.
* کنترل دسترسی ساده با ارسال `role` در payload انجام می‌شود. در محیط واقعی باید احراز هویت مناسب اضافه شود.
* استفاده از ORM خطرات SQL injection را کاهش داده و اعتبارسنجی در سطح serializer انجام می‌شود.
* پنل ادمین Django دست نخورده است و برای مدیریت سطح‌بالا قابل استفاده است.
